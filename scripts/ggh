#!/bin/bash

# URL opener command (customize based on your system)
# Examples: xdg-open (Linux), open (macOS), start (Windows/WSL)
URL_OPENER="xdg-open"

# Check if we're in a git repository
if ! git rev-parse --is-inside-work-tree &>/dev/null; then
    echo "Not in a git repository."
    exit 1
fi

# Get the remote URL (defaults to 'origin')
remote_url=$(git config --get remote.origin.url)

if [ -z "$remote_url" ]; then
    echo "No remote URL found for origin."
    exit 1
fi

# Convert SSH URL to HTTPS URL if needed
# Handles: git@github.com:user/repo.git
if [[ "$remote_url" =~ ^git@github\.com:(.+)$ ]]; then
    repo_path="${BASH_REMATCH[1]}"
    # Remove .git suffix if present
    repo_path="${repo_path%.git}"
    github_url="https://github.com/${repo_path}"
# Handle HTTPS URLs
elif [[ "$remote_url" =~ ^https?://github\.com/(.+)$ ]]; then
    repo_path="${BASH_REMATCH[1]}"
    # Remove .git suffix if present
    repo_path="${repo_path%.git}"
    github_url="https://github.com/${repo_path}"
# Handle personal urls
elif [[ "$remote_url" =~ ^aaa:(.+)$ ]]; then
    repo_path="${BASH_REMATCH[1]}"
    # Remove .git suffix if present
    repo_path="${repo_path%.git}"
    github_url="https://github.com/aaatipamula/${repo_path}"
elif [[ "$remote_url" =~ ^gh:(.+)$ ]]; then
    repo_path="${BASH_REMATCH[1]}"
    # Remove .git suffix if present
    repo_path="${repo_path%.git}"
    github_url="https://github.com/${repo_path}"
else
    echo "Remote URL is not a GitHub repository: $remote_url"
    exit 0
fi

# Open the GitHub URL
$URL_OPENER "$github_url"
